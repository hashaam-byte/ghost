// This is your Prisma schema file
// GhostX Complete Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// 1. USER & AUTHENTICATION
// ============================================

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  username      String?   @unique
  name          String?
  avatar        String?
  password      String?
  
  isGuest       Boolean   @default(false)
  isOnline      Boolean   @default(false)
  lastSeen      DateTime  @default(now())
  
  // Location (community map)
  communityZone String?
  latitude      Float?
  longitude     Float?
  
  // Profile
  plan          String    @default("free") // free, pro
  planExpiry    DateTime?
  isStudent     Boolean   @default(false)
  bio           String?
  aestheticScore Int      @default(0)
  profileTheme  String    @default("default")
  
  // Device
  deviceId      String?
  deviceModel   String?
  deviceOS      String?
  lastActive    DateTime  @default(now())
  
  // Offline sync
  lastSyncAt    DateTime  @default(now())
  offlineDataVersion Int   @default(1)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  ghostProfile       GhostProfile?
  tasks              Task[]
  quests             Quest[]
  chatMessages       ChatMessage[]
  xpHistory          XPHistory[]
  streaks            Streak[]
  badges             UserBadge[]
  inventory          InventoryItem[]
  voiceNotes         VoiceNote[]
  voicePacks         UserVoicePack[]
  scans              Scan[]
  notes              Note[]
  moodLogs           MoodLog[]
  deviceActivity     DeviceActivity[]
  appUsage           AppUsage[]
  appBlocks          AppBlock[]
  phoneSessions      PhoneSession[]
  notifications      Notification[]
  reminders          Reminder[]
  subscription       Subscription?
  usageStats         UsageStats?
  leaderboard        Leaderboard?
  nearbyGhosts       NearbyGhost[]     @relation("UserNearby")
  nearbyToOthers     NearbyGhost[]     @relation("NearbyUser")
  friendships        Friendship[]      @relation("UserFriendships")
  friendOf           Friendship[]      @relation("FriendOf")
  following          Follow[]          @relation("Follower")
  followers          Follow[]          @relation("Following")
  roomVisits         RoomVisit[]       @relation("Visitor")
  roomVisitors       RoomVisit[]       @relation("RoomOwner")
  giftsSent          Gift[]            @relation("Sender")
  giftsReceived      Gift[]            @relation("Receiver")
  reactions          Reaction[]
  dailyInsights      DailyInsight[]
  weeklyReports      WeeklyReport[]
  feedback           Feedback[]
  supportTickets     SupportTicket[]
  cryptoPortfolio    CryptoPortfolio[]
  gameStats          GameStats[]
  businessData       BusinessData?
  
  // NEW MODELS
  tutorialProgress   TutorialProgress[]
  appearanceSettings AppearanceSettings?
  ghostOverlay       GhostOverlay?
  ghostOverlayLogs   GhostOverlayLog[]
  ghostMemories      GhostMemory[]
  featureAccess      FeatureAccess[]
  evolutionHistory   EvolutionHistory[]
}

// ============================================
// 2. GHOST AI CORE
// ============================================

model GhostProfile {
  id              String   @id @default(cuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Personality & Mode
  personality     String   @default("chill") // chill, funny, productive, silent, coach
  tone            String?  @default("friendly")
  mode            String   @default("normal") // normal, chaotic, soft, dark, tsundere, y2k, roadman, nigerian, baby
  voicePack       String   @default("default")
  customSlang     String[]
  
  // Evolution
  evolutionStage  Int      @default(1) // 1-7 (baby to omega)
  ghostForm       String   @default("baby")
  
  // XP & Leveling
  totalXP         Int      @default(0)
  level           Int      @default(1)
  xpToNextLevel   Int      @default(100)
  coins           Int      @default(0)
  
  // Appearance
  avatarStyle     String   @default("basic")
  accessories     String[] // ["hoodie", "crown", "chains"]
  currentOutfit   String?
  skinColor       String   @default("#FFFFFF")
  glowColor       String   @default("#A020F0")
  auraColor       String   @default("pink")
  currentAnimation String  @default("float")
  personalityEmoji String  @default("ðŸ‘»")
  
  // Room 3D
  roomTheme       String   @default("default")
  roomItems       String[] // ["led_lights", "poster_anime"]
  roomRating      Int      @default(0)
  isRoomPublic    Boolean  @default(true)
  roomViews       Int      @default(0)
  
  // Behavioral AI
  mainFocusAreas  String[] // ["productivity", "health"]
  timezone        String   @default("Africa/Lagos")
  language        String   @default("en")
  isMorningPerson Boolean  @default(false)
  procrastinates  Boolean  @default(false)
  motivationStyle String   @default("positive")
  
  // Ghost State
  currentMood     String   @default("happy")
  currentEnergy   Float    @default(0.8)
  lastInteraction DateTime @default(now())
  isSleeping      Boolean  @default(false)
  isFloating      Boolean  @default(true)
  sleepSchedule   Json?
  
  // Learning & Memory
  learningData    Json?
  memorySnapshot  Json?
  userPreferences Json?
  
  // Stats
  totalInteractions Int    @default(0)
  totalChats        Int    @default(0)
  totalCommands     Int    @default(0)
  questsCompleted   Int    @default(0)
  streakDays        Int    @default(0)
  helpfulness       Int    @default(0)
  
  // Powers
  unlockedPowers  String[] // ["screen_overlay", "app_blocker"]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// ============================================
// 3. NEW MODELS (CRITICAL ADDITIONS)
// ============================================

// ðŸŽ® Tutorial System
model TutorialProgress {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  stepKey     String   // "swipe_right", "tap_ghost", "ghost_popup", etc.
  stepIndex   Int
  completed   Boolean  @default(false)
  
  completedAt DateTime?
  skipped     Boolean  @default(false)
  xpAwarded   Int      @default(0)
  
  createdAt   DateTime @default(now())
  
  @@unique([userId, stepKey])
  @@index([userId])
}

// ðŸŽ¨ Wallpaper & Theme Sync
model AppearanceSettings {
  id        String  @id @default(cuid())
  userId    String  @unique
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  mode      String  @default("auto") // auto | manual | gradient | amoled
  blur      Int     @default(20)
  darken    Float   @default(0.35)
  motion    Boolean @default(true)
  
  // Extracted from wallpaper (auto-generated)
  extractedPalette Json? // { primary, accent, glow }
  
  // Manual overrides
  overridePrimary String?
  overrideAccent  String?
  overrideGlow    String?
  lockTheme       Boolean @default(false)
  
  // Battery optimization
  batterySaverMode Boolean @default(false)
  particleDensity  Int     @default(50)
  
  updatedAt DateTime @updatedAt
}

// ðŸ“± Ghost Overlay System
model GhostOverlay {
  id        String  @id @default(cuid())
  userId    String  @unique
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  enabled   Boolean @default(true)
  size      String  @default("mini") // mini, compact
  snapEdge  String  @default("right") // left, right, top, bottom
  opacity   Float   @default(0.9)
  
  // Behavior
  autoDismissAfter Int? // seconds
  showOnLockScreen Boolean @default(false)
  
  lastUsedAt DateTime?
  updatedAt  DateTime @updatedAt
}

model GhostOverlayLog {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  duration    Int      // seconds
  contextApp  String?  // package name of app where popup appeared
  
  actionTaken String?  // "voice_command", "dismissed", "expanded"
  
  createdAt   DateTime @default(now())
  
  @@index([userId, createdAt])
}

// ðŸ§  Ghost Memory System
model GhostMemory {
  id         String  @id @default(cuid())
  userId     String
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type       String  // preference, habit, boundary, trigger, fact
  key        String  // "study_time", "favorite_subject", etc.
  value      Json    // Flexible storage
  
  confidence Float   @default(0.8) // 0.0-1.0
  source     String? // chat, task, device, manual, inferred
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  @@unique([userId, type, key])
  @@index([userId, type])
}

// ðŸ”“ Feature Discovery System
model FeatureAccess {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  feature    String   // ghost_popup, crypto_scan, room_public, etc.
  unlocked   Boolean  @default(false)
  
  unlockedAt DateTime?
  reason     String?  // level_5, tutorial_complete, quest_reward
  
  @@unique([userId, feature])
  @@index([userId])
}

// ðŸ§¬ Ghost Evolution History
model EvolutionHistory {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fromStage Int
  toStage   Int
  fromForm  String
  toForm    String
  
  trigger   String   // xp_threshold, quest_complete, seasonal_event, special
  xpAtEvolution Int?
  
  createdAt DateTime @default(now())
  
  @@index([userId])
}

// ============================================
// 4. GAMIFICATION & XP
// ============================================

model XPHistory {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  amount      Int
  reason      String
  category    String   // quest, chat, task, social, gaming, study
  questId     String?
  
  // Offline sync
  syncedToServer Boolean @default(false)
  localId        String?
  
  createdAt   DateTime @default(now())
  
  @@index([userId, createdAt])
}

model Streak {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type        String   // daily_login, quest, productivity, study, exercise
  count       Int      @default(0)
  bestStreak  Int      @default(0)
  lastUpdated DateTime @default(now())
  isActive    Boolean  @default(true)
  
  @@unique([userId, type])
}

// ============================================
// 5. QUEST SYSTEM
// ============================================

model Quest {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title       String
  description String
  type        String   // daily, weekly, challenge, seasonal, realtime, social
  category    String   // productivity, health, social, app_usage, study, gaming
  
  // Requirements
  target      Int      // Target number
  progress    Int      @default(0)
  unit        String   @default("count")
  
  // Rewards
  xpReward    Int
  coinReward  Int      @default(0)
  itemReward  String?
  badgeReward String?
  
  status      String   @default("active") // active, completed, failed, expired
  expiresAt   DateTime?
  completedAt DateTime?
  
  // Metadata
  difficulty  String   @default("easy")
  season      String?
  isRepeatable Boolean @default(false)
  cooldown    Int?
  
  // Realtime tracking
  trackingData Json?
  
  // Offline support
  canCompleteOffline Boolean @default(true)
  syncedToServer     Boolean @default(false)
  localId            String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId, status])
}

// ============================================
// 6. TASK MANAGEMENT
// ============================================

model Task {
  id          String    @id @default(cuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title       String
  description String?   @db.Text
  category    String    // productivity, personal, work, study, health
  priority    String    @default("medium") // low, medium, high, urgent
  status      String    @default("pending") // pending, in_progress, completed, cancelled
  
  dueDate     DateTime?
  completedAt DateTime?
  
  xpReward    Int       @default(10)
  xpAwarded   Boolean   @default(false)
  
  scheduledAt DateTime?
  duration    Int?
  
  // Reminders
  reminderTime DateTime?
  reminderSent Boolean  @default(false)
  
  // Subtasks
  subtasks    Json?
  
  // Offline support
  localId     String?
  syncedToServer Boolean @default(false)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([userId, status])
}

// ============================================
// 7. BADGES & ACHIEVEMENTS
// ============================================

model Badge {
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  icon        String   // emoji or icon name
  rarity      String   // common, rare, epic, legendary, mythic
  category    String   // xp, streak, social, quest, special, seasonal
  
  // Unlock requirements
  requirement String
  requirementValue Int?
  
  // Visual
  glowColor   String?
  animation   String?
  
  users       UserBadge[]
  
  createdAt   DateTime @default(now())
}

model UserBadge {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  badgeId   String
  badge     Badge    @relation(fields: [badgeId], references: [id])
  
  isDisplayed Boolean  @default(false)
  isPinned    Boolean  @default(false)
  earnedAt    DateTime @default(now())
  
  @@unique([userId, badgeId])
}

// ============================================
// 8. SHOP & INVENTORY
// ============================================

model ShopItem {
  id          String   @id @default(cuid())
  name        String
  description String
  type        String   // accessory, room_item, voice_pack, ghost_skin, animation, power
  category    String   // ghost, room, special, seasonal
  
  // Pricing
  coinPrice   Int?
  xpPrice     Int?
  isPremium   Boolean  @default(false)
  
  // Item data
  itemData    Json
  preview     String?
  rarity      String   @default("common")
  season      String?
  
  // Availability
  isLimited   Boolean  @default(false)
  stock       Int?
  expiresAt   DateTime?
  unlockLevel Int?
  
  inventory   InventoryItem[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model InventoryItem {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  itemId      String
  item        ShopItem @relation(fields: [itemId], references: [id])
  
  isEquipped  Boolean  @default(false)
  isFavorite  Boolean  @default(false)
  acquiredAt  DateTime @default(now())
  acquiredFrom String? // "purchase", "quest", "gift", "season"
  
  @@unique([userId, itemId])
}

// ============================================
// 9. COMMUNITY & SOCIAL
// ============================================

model NearbyGhost {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation("UserNearby", fields: [userId], references: [id], onDelete: Cascade)
  nearbyUserId String
  nearbyUser  User     @relation("NearbyUser", fields: [nearbyUserId], references: [id], onDelete: Cascade)
  
  distance    Float?   // in meters
  zone        String
  
  canInteract Boolean  @default(true)
  hasInteracted Boolean @default(false)
  lastSeen    DateTime @default(now())
  
  ghostMood   String?
  ghostAnimation String?
  ghostLevel  Int?
  
  @@unique([userId, nearbyUserId])
}

model CommunityZone {
  id          String   @id @default(cuid())
  name        String   @unique // "Lagos_Mainland"
  displayName String
  country     String
  region      String?
  
  // Boundaries
  centerLat   Float
  centerLong  Float
  radius      Float
  
  // Stats
  activeGhosts Int     @default(0)
  totalUsers   Int     @default(0)
  
  // Hot spots
  hotspots    Json?
  
  // Events
  currentEvent String?
  eventData    Json?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Friendship {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation("UserFriendships", fields: [userId], references: [id], onDelete: Cascade)
  friendId    String
  friend      User     @relation("FriendOf", fields: [friendId], references: [id], onDelete: Cascade)
  
  status      String   @default("pending") // pending, accepted, blocked
  
  sharedXP    Int      @default(0)
  interactions Int     @default(0)
  
  createdAt   DateTime @default(now())
  acceptedAt  DateTime?
  
  @@unique([userId, friendId])
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String
  follower    User     @relation("Follower", fields: [followerId], references: [id], onDelete: Cascade)
  followingId String
  following   User     @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  
  @@unique([followerId, followingId])
}

model RoomVisit {
  id          String   @id @default(cuid())
  visitorId   String
  visitor     User     @relation("Visitor", fields: [visitorId], references: [id], onDelete: Cascade)
  roomOwnerId String
  roomOwner   User     @relation("RoomOwner", fields: [roomOwnerId], references: [id], onDelete: Cascade)
  
  rating      Int?     // 1-5 stars
  comment     String?
  reactions   String[] // ["fire", "wow", "cool"]
  
  visitedAt   DateTime @default(now())
}

model Gift {
  id          String   @id @default(cuid())
  senderId    String
  sender      User     @relation("Sender", fields: [senderId], references: [id], onDelete: Cascade)
  receiverId  String
  receiver    User     @relation("Receiver", fields: [receiverId], references: [id], onDelete: Cascade)
  
  giftType    String   // coins, item, accessory, xp_boost, special
  giftData    Json
  message     String?
  
  isOpened    Boolean  @default(false)
  openedAt    DateTime?
  sentAt      DateTime @default(now())
}

model Reaction {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  targetType  String   // room, profile, quest_completion, achievement
  targetId    String
  
  reactionType String  // fire, heart, wow, laugh, clap, ghost
  
  createdAt   DateTime @default(now())
  
  @@unique([userId, targetType, targetId, reactionType])
}

// ============================================
// 10. LEADERBOARD
// ============================================

model Leaderboard {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Global Rankings
  xpRank      Int?
  levelRank   Int?
  aestheticRank Int?
  streakRank  Int?
  questRank   Int?
  
  // Scores
  totalXP     Int      @default(0)
  level       Int      @default(1)
  aestheticScore Int   @default(0)
  streakDays  Int      @default(0)
  questsCompleted Int  @default(0)
  
  // Regional
  regionalRank Int?
  communityZone String?
  
  // Seasonal
  season      String?
  seasonRank  Int?
  seasonPoints Int     @default(0)
  
  // Trends
  rankChange  Int      @default(0)
  isRising    Boolean  @default(false)
  
  updatedAt   DateTime @updatedAt
}

// ============================================
// 11. DEVICE TRACKING (Ghost Guardian)
// ============================================

model DeviceActivity {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  date          DateTime @default(now())
  
  // Screen Time
  totalScreenTime Int    @default(0) // seconds
  productiveTime  Int    @default(0)
  distractionTime Int    @default(0)
  
  // Stats
  unlockCount   Int      @default(0)
  notificationCount Int  @default(0)
  
  // Battery
  batteryStart  Int?
  batteryEnd    Int?
  batteryDrain  Int?
  
  // Sleep
  sleepTime     DateTime?
  wakeTime      DateTime?
  sleepQuality  Int?
  
  // Mood
  detectedMood  String?
  productivity  Int?
  stressLevel   Int?
  
  warningsGiven Int      @default(0)
  
  @@unique([userId, date])
}

model AppUsage {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  date          DateTime @default(now())
  appName       String
  packageName   String
  icon          String?
  
  timeSpent   Int      @default(0) // seconds
  openCount   Int      @default(0)
  lastOpened  DateTime?
  
  category    String?
  isDistraction Boolean @default(false)
  isProductive Boolean @default(false)
  
  @@unique([userId, packageName, date])
}

model AppBlock {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  packageName String
  appName     String
  
  isBlocked   Boolean  @default(true)
  blockUntil  DateTime?
  blockReason String?
  
  allowEmergency Boolean @default(true)
  maxUnlocks     Int?
  unlocksUsed    Int    @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([userId, packageName])
}

model PhoneSession {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  startTime   DateTime
  endTime     DateTime?
  duration    Int?
  
  unlockCount     Int  @default(0)
  notificationCount Int @default(0)
  appsUsed        String[]
  
  // AI Analysis
  sessionType     String?  // productive, distracted, balanced, focused
  detectedMood    String?
  stressLevel     Int?
  
  ghostWarnings   Int    @default(0)
  ghostHelped     Boolean @default(false)
  
  date        DateTime @default(now())
  
  @@index([userId, date])
}

// ============================================
// 12. VOICE & COMMUNICATION
// ============================================

model VoiceNote {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  audioUrl    String
  duration    Int      // seconds
  
  voiceType   String   // original, aesthetic_girl, deep, anime, whisper, robot
  transcription String? @db.Text
  
  isPublic    Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  
  @@index([userId])
}

model VoicePack {
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  gender      String   // male, female, neutral, anime, robot
  style       String   // cute, chaotic, deep, whisper, energetic, calm
  
  isPremium   Boolean  @default(false)
  coinPrice   Int?
  
  sampleData  Json?
  previewUrl  String?
  
  unlockLevel Int?
  season      String?
  
  users       UserVoicePack[]
  
  createdAt   DateTime @default(now())
}

model UserVoicePack {
  id          String    @id @default(cuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  voicePackId String
  voicePack   VoicePack @relation(fields: [voicePackId], references: [id])
  
  isActive    Boolean   @default(false)
  purchasedAt DateTime  @default(now())
  
  @@unique([userId, voicePackId])
}

// ============================================
// 13. CHAT & MESSAGES
// ============================================

model ChatMessage {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  role        String   // user, assistant, system
  content     String   @db.Text
  xpAwarded   Int?
  category    String?
  
  // Metadata
  mood        String?
  intent      String?  // help, chat, command, question
  tone        String?  @default("friendly")
  
  // Offline
  localId     String?
  syncedToServer Boolean @default(false)
  
  createdAt   DateTime @default(now())
  
  @@index([userId, createdAt])
}

// ============================================
// 14. NOTES & STUDY
// ============================================

model Note {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title       String
  content     String   @db.Text
  subject     String?
  
  // AI-generated
  summary     String?  @db.Text
  keyPoints   String[]
  flashcards  Json?
  
  imageUrl    String?
  tags        String[]
  
  // Study features
  difficulty  String?
  studyCount  Int      @default(0)
  lastStudied DateTime?
  
  // Offline
  localId     String?
  syncedToServer Boolean @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
}

// ============================================
// 15. GHOST SCANNER
// ============================================

model Scan {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  scanType      String   // dm, crypto, social, general
  description   String   @db.Text
  context       String?  @db.Text
  
  // AI Analysis
  analysis      String   @db.Text
  redFlags      String[]
  tone          String?
  sentiment     String?
  recommendation String? @db.Text
  threatLevel   String?  // safe, caution, warning, danger
  confidence    Float?
  
  xpAwarded     Int      @default(5)
  
  // Offline
  localId       String?
  syncedToServer Boolean @default(false)
  
  createdAt     DateTime @default(now())
  
  @@index([userId])
}

// ============================================
// 16. CRYPTO, GAMING & BUSINESS
// ============================================

model CryptoPortfolio {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  coinSymbol  String
  coinName    String
  amount      Float
  buyPrice    Float
  currentPrice Float?
  
  walletAddress String?
  
  profitLoss  Float?
  profitLossPercent Float?
  
  localId     String?
  syncedToServer Boolean @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model GameStats {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  gameName    String
  
  accuracy    Float?
  kdRatio     Float?
  winRate     Float?
  rank        String?
  
  sensitivity Json?
  recommendations Json?
  
  lastPlayed  DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([userId, gameName])
}

model BusinessData {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  businessName String?
  businessType String?
  
  revenue     Float    @default(0)
  expenses    Float    @default(0)
  profit      Float    @default(0)
  
  ideas       Json?
  goals       Json?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ============================================
// 17. MOOD & MENTAL HEALTH
// ============================================

model MoodLog {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  mood        String   // happy, sad, anxious, stressed, excited, calm, tired
  energy      Int      // 1-10
  stress      Int      // 1-10
  
  sleepHours  Float?
  notes       String?  @db.Text
  
  // AI Analysis
  aiInsights  String?  @db.Text
  suggestions String[]
  
  activities  String[]
  
  localId     String?
  syncedToServer Boolean @default(false)
  
  createdAt   DateTime @default(now())
  
  @@index([userId, createdAt])
}

// ============================================
// 18. SUBSCRIPTION & BILLING
// ============================================

model Subscription {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  plan        String   // free, ghost_plus, ghost_pro
  status      String   @default("active")
  
  amount      Float?
  currency    String   @default("NGN")
  interval    String?  // monthly, yearly
  
  startDate   DateTime @default(now())
  endDate     DateTime?
  
  paymentMethod String?
  lastPaymentDate DateTime?
  nextBillingDate DateTime?
  
  isStudent   Boolean  @default(false)
  studentVerified Boolean @default(false)
  studentIdUrl String?
  
  features    Json?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model UsageStats {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  chatCount   Int      @default(0)
  chatLimit   Int      @default(50)
  
  scanCount   Int      @default(0)
  scanLimit   Int      @default(10)
  schoolScanCount Int  @default(0)
  schoolScanLimit Int  @default(5)
  
  voiceNoteCount Int   @default(0)
  voiceNoteLimit Int   @default(20)
  
  apiCallCount Int    @default(0)
  apiCallLimit Int    @default(1000)
  
  lastResetDate DateTime @default(now())
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ============================================
// 19. NOTIFICATIONS
// ============================================

model Notification {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type        String   // quest_complete, level_up, friend_request, gift, reminder, achievement
  title       String
  message     String   @db.Text
  
  data        Json?
  
  actionLabel String?
  actionUrl   String?
  
  isRead      Boolean  @default(false)
  isPushed    Boolean  @default(false)
  
  expiresAt   DateTime?
  
  createdAt   DateTime @default(now())
  
  @@index([userId, isRead])
}

model Reminder {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title       String
  message     String?
  
  reminderTime DateTime
  
  isRecurring Boolean  @default(false)
  recurringPattern String?
  customDays  Int[]
  
  isActive    Boolean  @default(true)
  isSent      Boolean  @default(false)
  lastSentAt  DateTime?
  
  relatedType String?
  relatedId   String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId, reminderTime])
}

// ============================================
// 20. ANALYTICS & INSIGHTS
// ============================================

model DailyInsight {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  date        DateTime @default(now())
  
  productivityScore Int
  focusTime    Int
  distractionTime Int
  
  goalsCompleted Int  @default(0)
  goalsTotal     Int  @default(0)
  
  habitsCompleted String[]
  streakMaintained Boolean @default(false)
  
  summary      String  @db.Text
  highlights   String[]
  improvements String[]
  
  tomorrowPlan Json?
  
  @@unique([userId, date])
}

model WeeklyReport {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  weekStart   DateTime
  weekEnd     DateTime
  
  totalXP     Int
  totalTasks  Int
  totalFocus  Int
  avgProductivity Float
  
  questsCompleted Int
  goalsAchieved   Int
  
  topAchievements String[]
  areasToImprove  String[]
  weekRating      Int?
  
  ghostMessage String?  @db.Text
  
  createdAt   DateTime @default(now())
  
  @@index([userId, weekStart])
}

// ============================================
// 21. SEASONAL EVENTS
// ============================================

model SeasonalEvent {
  id          String   @id @default(cuid())
  name        String
  description String
  season      String   @unique
  
  startDate   DateTime
  endDate     DateTime
  
  exclusiveItems String[]
  specialQuests  String[]
  eventBadges    String[]
  
  eventZones     Json?
  
  hasLeaderboard Boolean @default(false)
  leaderboardPrizes Json?
  
  isActive    Boolean  @default(false)
  
  createdAt   DateTime @default(now())
}

// ============================================
// 22. FEEDBACK & SUPPORT
// ============================================

model Feedback {
  id          String   @id @default(cuid())
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type        String   // bug, feature_request, complaint, praise, general
  category    String?
  
  title       String
  description String   @db.Text
  
  deviceInfo  Json?
  screenshots String[]
  
  status      String   @default("pending")
  priority    String   @default("medium")
  
  adminResponse String? @db.Text
  respondedAt   DateTime?
  respondedBy   String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SupportTicket {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  subject     String
  message     String   @db.Text
  
  status      String   @default("open")
  priority    String   @default("normal")
  
  messages    Json?
  
  assignedTo  String?
  
  resolvedAt  DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ============================================
// 23. SYSTEM & ADMIN
// ============================================

model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  
  description String?
  
  updatedAt   DateTime @updatedAt
}

model AppVersion {
  id          String   @id @default(cuid())
  version     String   @unique
  platform    String   // ios, android, web
  
  buildNumber Int
  
  isRequired  Boolean  @default(false)
  releaseNotes String  @db.Text
  downloadUrl String?
  
  newFeatures String[]
  bugFixes    String[]
  
  releasedAt  DateTime @default(now())
}

model MaintenanceMode {
  id          String   @id @default(cuid())
  isActive    Boolean  @default(false)
  
  message     String   @db.Text
  startTime   DateTime?
  endTime     DateTime?
  
  affectedServices String[]
  
  updatedAt   DateTime @updatedAt
}